<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="575px" preserveAspectRatio="none" style="width:1007px;height:575px;" version="1.1" viewBox="0 0 1007 575" width="1007px" zoomAndPan="magnify"><defs><filter height="300%" id="fu3ug1vl5seqe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="94" y="69.7988"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="99" y="107.1094"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="258.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401.5" y="170.7305"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="221.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="406.5" y="208.041"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="411.5" y="250.3516"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="106.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="411.5" y="322.6621"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="364.9727"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="640.5" y="429.2832"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="58.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="796.5" y="458.5938"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="962.5" y="487.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="98.5" x2="98.5" y1="38.4883" y2="535.2148"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="251.5" x2="251.5" y1="38.4883" y2="535.2148"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="406.5" x2="406.5" y1="38.4883" y2="535.2148"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="645" x2="645" y1="38.4883" y2="535.2148"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="801.5" x2="801.5" y1="38.4883" y2="535.2148"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="967.5" x2="967.5" y1="38.4883" y2="535.2148"/><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="47.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="54.5" y="23.5352">ContextImpl</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="47.5" y="534.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="54.5" y="554.75">ContextImpl</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="164.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="171.5" y="23.5352">ActivityManagerService</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="164.5" y="534.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="171.5" y="554.75">ActivityManagerService</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="349.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="356.5" y="23.5352">ActiveServices</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="349.5" y="534.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="356.5" y="554.75">ActiveServices</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="573" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="580" y="23.5352">ApplicationThread</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="141" x="573" y="534.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="127" x="580" y="554.75">ApplicationThread</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="743.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="750.5" y="23.5352">ActivityThread</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="743.5" y="534.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="750.5" y="554.75">ActivityThread</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="934.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="941.5" y="23.5352">Service</text><rect fill="#FEFECE" filter="url(#fu3ug1vl5seqe)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="934.5" y="534.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="941.5" y="554.75">Service</text><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="94" y="69.7988"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="34.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="99" y="107.1094"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="258.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401.5" y="170.7305"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="221.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="406.5" y="208.041"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="411.5" y="250.3516"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="106.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="411.5" y="322.6621"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="364.9727"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="640.5" y="429.2832"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="58.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="796.5" y="458.5938"/><rect fill="#FFFFFF" filter="url(#fu3ug1vl5seqe)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="962.5" y="487.9043"/><polygon fill="#A80036" points="82,65.7988,92,69.7988,82,73.7988,86,69.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="88" y1="69.7988" y2="69.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="10" y="65.0566">stopService</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="151" y1="94.1094" y2="94.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="151" x2="151" y1="94.1094" y2="107.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="110" x2="151" y1="107.1094" y2="107.1094"/><polygon fill="#A80036" points="120,103.1094,110,107.1094,120,111.1094,116,107.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="116" y="89.3672">stopServiceCommon</text><polygon fill="#A80036" points="240,137.4199,250,141.4199,240,145.4199,244,141.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="246" y1="141.4199" y2="141.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="106" y="136.6777"> stopService</text><polygon fill="#A80036" points="389.5,166.7305,399.5,170.7305,389.5,174.7305,393.5,170.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="252" x2="395.5" y1="170.7305" y2="170.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="259" y="165.9883">stopServiceLocked</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="411.5" x2="458.5" y1="195.041" y2="195.041"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="458.5" x2="458.5" y1="195.041" y2="208.041"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="417.5" x2="458.5" y1="208.041" y2="208.041"/><polygon fill="#A80036" points="427.5,204.041,417.5,208.041,427.5,212.041,423.5,208.041" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="423.5" y="190.2988">bringDownServiceIfNeededLocked</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="421.5" x2="463.5" y1="242.3516" y2="242.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="463.5" x2="463.5" y1="242.3516" y2="255.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="422.5" x2="463.5" y1="255.3516" y2="255.3516"/><polygon fill="#A80036" points="432.5,251.3516,422.5,255.3516,432.5,259.3516,428.5,255.3516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="428.5" y="237.6094">isServiceNeededLocked</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="416.5" x2="463.5" y1="309.6621" y2="309.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="463.5" x2="463.5" y1="309.6621" y2="322.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="422.5" x2="463.5" y1="322.6621" y2="322.6621"/><polygon fill="#A80036" points="432.5,318.6621,422.5,322.6621,432.5,326.6621,428.5,322.6621" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="428.5" y="304.9199">bringDownServiceLocked</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="356.9727" y2="356.9727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="356.9727" y2="369.9727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="369.9727" y2="369.9727"/><polygon fill="#A80036" points="437.5,365.9727,427.5,369.9727,437.5,373.9727,433.5,369.9727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="433.5" y="352.2305">unscheduleServiceRestartLocked</text><polygon fill="#A80036" points="628.5,425.2832,638.5,429.2832,628.5,433.2832,632.5,429.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="634.5" y1="429.2832" y2="429.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="413.5" y="424.541">  scheduleStopService</text><polygon fill="#A80036" points="784.5,454.5938,794.5,458.5938,784.5,462.5938,788.5,458.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="645.5" x2="790.5" y1="458.5938" y2="458.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="652.5" y="453.8516"> handleStopService</text><polygon fill="#A80036" points="950.5,483.9043,960.5,487.9043,950.5,491.9043,954.5,487.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="806.5" x2="956.5" y1="487.9043" y2="487.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="813.5" y="483.1621">onDestroy</text><polygon fill="#A80036" points="955.5,513.2148,965.5,517.2148,955.5,521.2148,959.5,517.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801.5" x2="961.5" y1="517.2148" y2="517.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="808.5" y="512.4727"> detachAndCleanUp</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="958.5" x2="976.5" y1="508.2148" y2="526.2148"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="958.5" x2="976.5" y1="526.2148" y2="508.2148"/><!--
@startuml stopService
participant ContextImpl
participant ActivityManagerService
participant ActiveServices
[-> ContextImpl: stopService
activate ContextImpl
ContextImpl -> ContextImpl ++: stopServiceCommon
ContextImpl -> ActivityManagerService - -:  stopService
deactivate ContextImpl

ActivityManagerService -> ActiveServices: stopServiceLocked

activate ActiveServices
ActiveServices -> ActiveServices ++: bringDownServiceIfNeededLocked
ActiveServices -> ActiveServices ++: isServiceNeededLocked
deactivate ActiveServices
ActiveServices -> ActiveServices ++: bringDownServiceLocked
ActiveServices -> ActiveServices ++: unscheduleServiceRestartLocked
deactivate ActiveServices
ActiveServices -> ApplicationThread - -:   scheduleStopService
deactivate ActiveServices
deactivate ActiveServices

activate ApplicationThread
ApplicationThread -> ActivityThread - -:  handleStopService
activate ActivityThread
ActivityThread -> Service ++: onDestroy
ActivityThread -> Service:  detachAndCleanUp
deactivate ActivityThread
destroy Service
@enduml

PlantUML version 1.2019.09(Tue Aug 27 00:19:51 CST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 10.0.2+13
Operating System: Mac OS X
OS Version: 10.14.6
Default Encoding: US-ASCII
Language: zh
Country: CN
--></g></svg>